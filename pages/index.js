import { useState } from 'react'
import { Card, CardBody, ClipboardCopy, TextContent, Text, TextVariants, Page, PageSidebar, PageSection,
            Form, FormGroup, FormSection, ToggleGroup, ToggleGroupItem, PageSectionVariants,
            NumberInput, Masthead, MastheadMain, MastheadContent } from '@patternfly/react-core'
import { ChartDonutThreshold, ChartDonutUtilization, ChartThemeColor } from '@patternfly/react-charts'
import { compute_vector, to_vector_str } from 'cwssjs'


const metrics = [
    {
        title: "Base Finding",
        factors: [
            {
                title: "Technical Impact",
                short: "TI",
                options: [
                    {
                        name: "Critical",
                        tooltip: "",
                        value: "C",
                        weight: 1.0
                    },
                    {
                        name: "High",
                        tooltip: "",
                        value: "H",
                        weight: 0.9
                    },
                    {
                        name: "Medium",
                        tooltip: "",
                        value: "M",
                        weight: 0.6
                    },
                    {
                        name: "Low",
                        tooltip: "",
                        value: "L",
                        weight: 0.3
                    },
                    {
                        name: "None",
                        tooltip: "",
                        value: "N",
                        weight: 0.0
                    },
                    {
                        name: "Default",
                        tooltip: "The Default weight is the median of the weights for Critical, High, Medium, Low, and None.",
                        value: "D",
                        weight: 0.6,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Acquired Privilege",
                short: "AP",
                options: [
                    {
                        name: "Administrator",
                        tooltip: "",
                        value: "A",
                        weight: 1.0
                    },
                    {
                        name: "Partially-Privileged User",
                        tooltip: "",
                        value: "P",
                        weight: 0.9
                    },
                    {
                        name: "Regular User",
                        tooltip: "",
                        value: "RU",
                        weight: 0.7
                    },
                    {
                        name: "Limited / Guest",
                        tooltip: "",
                        value: "L",
                        weight: 0.6
                    },
                    {
                        name: "None",
                        tooltip: "",
                        value: "N",
                        weight: 0.1
                    },
                    {
                        name: "Default",
                        tooltip: "Median of the weights for None, Guest, Regular User, Partially-Privileged User, and Administrator.",
                        value: "D",
                        weight: 0.7,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Acquired Privilege Layer",
                short: "AL",
                options: [
                    {
                        name: "Application",
                        tooltip: "",
                        value: "A",
                        weight: 1.0
                    },
                    {
                        name: "System",
                        tooltip: "",
                        value: "S",
                        weight: 0.9
                    },
                    {
                        name: "Network",
                        tooltip: "",
                        value: "N",
                        weight: 0.7
                    },
                    {
                        name: "Enterprise Infrastructure",
                        tooltip: "",
                        value: "E",
                        weight: 1.0
                    },
                    {
                        name: "Default",
                        tooltip: "Median of the weights for Application, System, Network, and Enterprise Infrastructure.",
                        value: "D",
                        weight: 0.9,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Internal Control Effectiveness",
                short: "IC",
                options: [
                    {
                        name: "None",
                        tooltip: "No controls exist.",
                        value: "N",
                        weight: 1.0
                    },
                    {
                        name: "Limited",
                        tooltip: "There are simplistic methods or accidental restrictions that might prevent a casual attacker from exploiting the issue.",
                        value: "L",
                        weight: 0.9
                    },
                    {
                        name: "Moderate",
                        tooltip: "",
                        value: "M",
                        weight: 0.7
                    },
                    {
                        name: "Indirect (Defense-in-Depth)",
                        tooltip: "",
                        value: "I",
                        weight: 0.5
                    },
                    {
                        name: "Best-Available",
                        tooltip: "",
                        value: "B",
                        weight: 0.3
                    },
                    {
                        name: "Complete",
                        tooltip: "",
                        value: "C",
                        weight: 0.0
                    },
                    {
                        name: "Default",
                        tooltip: "Median of the weights for Complete, Best-Available, Indirect, Moderate, Limited, and None.", 
                        value: "D",
                        weight: 0.6,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Finding Confidence",
                short: "FC",
                options: [
                    {
                        name: "Proven True",
                        tooltip: "The weakness is reachable by the attacker.",
                        value: "T",
                        weight: 1.0
                    },
                    {
                        name: "Proven Locally True",
                        tooltip: "",
                        value: "LT",
                        weight: 0.8
                    },
                    {
                        name: "Proven False",
                        tooltip: "The finding is erroneous (i.e. the finding is a false positive and there is no weakness), and/or there is no possible attacker role.",
                        value: "F",
                        weight: 0.0
                    },
                    {
                        name: "Default",
                        tooltip: "Median of the weights for Proven True, Proven Locally True, and Proven False.",
                        value: "D",
                        weight: 0.8,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
        ],
    },
    {
        title: "Attack Surface",
        factors: [
            {
                title: "Required Privilege",
                short: "RP",
                options: [
                    {
                        name: "None",
                        tooltip: "",
                        value: "N",
                        weight: 1.0
                    }, 
                    {
                        name: "Limited / Guest",
                        tooltip: "",
                        value: "L",
                        weight: 0.9
                    }, 
                    {
                        name: "Regular User",
                        tooltip: "",
                        value: "RU",
                        weight: 0.7
                    }, 
                    {
                        name: "Partially-Privileged User",
                        tooltip: "",
                        value: "P",
                        weight: 0.6
                    }, 
                    {
                        name: "Administrator",
                        tooltip: "",
                        value: "A",
                        weight: 0.1
                    }, 
                    {
                        name: "Default",
                        tooltip: "Median of the weights for None, Limited, Regular User, Partially-Privileged User, and Administrator.",
                        value: "D",
                        weight: 0.7,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Required Privilege Layer",
                short: "RL",
                options: [
                    {
                        name: "Application",
                        tooltip: "",
                        value: "A",
                        weight: 1.0
                    }, 
                    {
                        name: "System",
                        tooltip: "",
                        value: "S",
                        weight: 0.9
                    }, 
                    {
                        name: "Network",
                        tooltip: "",
                        value: "N",
                        weight: 0.7
                    }, 
                    {
                        name: "Enterprise Infrastructure",
                        tooltip: "",
                        value: "E",
                        weight: 1.0
                    },
                    {
                        name: "Default",
                        tooltip: "Median of the weights for Application, System, Network, and Enterprise Infrastructure.",
                        value: "D",
                        weight: 0.9,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Access Vector",
                short: "AV",
                options: [
                    {
                        name: "Internet",
                        tooltip: "An attacker must have access to the Internet to reach the weakness.",
                        value: "I",
                        weight: 1.0
                    }, 
                    {
                        name: "Intranet",
                        tooltip: "An attacker must have access to an enterprise intranet that is shielded from direct access from the Internet, e.g. by using a firewall, but otherwise the intranet is accessible to most members of the enterprise.",
                        value: "R",
                        weight: 0.8
                    }, 
                    {
                        name: "Private Network",
                        tooltip: "An attacker muts have access to a private network that is only accessible to a narrowly-defined set of trusted parties.",
                        value: "V",
                        weight: 0.8
                    }, 
                    {
                        name: "Adjacent Network",
                        tooltip: "",
                        value: "A",
                        weight: 0.7
                    }, 
                    {
                        name: "Local",
                        tooltip: "The attacker must have an interactive, local (shell) account that interfaces directly with the underlying operating system.",
                        value: "L",
                        weight: 0.5
                    }, 
                    {
                        name: "Physical",
                        tooltip: "",
                        value: "P",
                        weight: 0.2
                    }, 
                    {
                        name: "Default",
                        tooltip: "Median of weights for relevant values.",
                        value: "D",
                        weight: 0.75,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Authentication Strength",
                short: "AS",
                options: [
                    {
                        name: "Strong",
                        tooltip: "",
                        value: "S",
                        weight: 0.7
                    }, 
                    {
                        name: "Moderate",
                        tooltip: "",
                        value: "M",
                        weight: 0.8
                    }, 
                    {
                        name: "Weak",
                        tooltip: "",
                        value: "W",
                        weight: 0.9
                    }, 
                    {
                        name: "None",
                        tooltip: "The weakness does not require any authentication at all.",
                        value: "N",
                        weight: 1.0
                    }, 
                    {
                        name: "Default",
                        tooltip: "Median of values for Strong, Moderate, Weak, and None.",
                        value: "D",
                        weight: 0.85,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Level of Interaction",
                short: "IN",
                options: [
                    {
                        name: "Automated",
                        tooltip: "No human interaction required.",
                        value: "A",
                        weight: 1.0
                    }, 
                    {
                        name: "Typical/Limited",
                        tooltip: "",
                        value: "T",
                        weight: 0.9
                    }, 
                    {
                        name: "Moderate",
                        tooltip: "",
                        value: "M",
                        weight: 0.8
                    }, 
                    {
                        name: "Opportunistic",
                        tooltip: "",
                        value: "O",
                        weight: 0.3
                    }, 
                    {
                        name: "High",
                        tooltip: "",
                        value: "H",
                        weight: 0.1
                    }, 
                    {
                        name: "No Interaction",
                        tooltip: "",
                        value: "NI",
                        weight: 0.0
                    }, 
                    {
                        name: "Default",
                        tooltip: "Median of values for Automated, Limited, Moderate, Opportunistic, High, and No interaction.",
                        value: "D",
                        weight: 0.55,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Deployment Scope",
                short: "SC",
                options: [
                    {
                        name: "All",
                        tooltip: "Present in all platforms or configurations.",
                        value: "A",
                        weight: 1.0
                    }, 
                    {
                        name: "Moderate",
                        tooltip: "Present in common platforms or configurations.",
                        value: "M",
                        weight: 0.9
                    }, 
                    {
                        name: "Rare",
                        tooltip: "Only present in rare platforms or configurations.",
                        value: "R",
                        weight: 0.5
                    }, 
                    {
                        name: "Potentially Reachable",
                        tooltip: "",
                        value: "P",
                        weight: 0.1
                    }, 
                    {
                        name: "Default",
                        tooltip: "The median of weights for RAMP values",
                        value: "D",
                        weight: 0.7,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            }
        ],
    },
    {
        title: "Environmental",
        factors: [
            {
                title: "Business Impact",
                short: "BI",
                options: [
                    {
                        name: "Critical",
                        tooltip: "The business/mission could fail.",
                        value: "C",
                        weight: 1.0
                    }, 
                    {
                        name: "High",
                        tooltip: "The operations of the business/mission would be significantly affected.",
                        value: "H",
                        weight: 0.9
                    }, 
                    {
                        name: "Medium",
                        tooltip: "The business/mission would be affected, but without extensive damage to regular operations.",
                        value: "M",
                        weight: 0.6
                    }, 
                    {
                        name: "Low",
                        tooltip: "Minimal impact on the business/mission.",
                        value: "L",
                        weight: 0.3
                    }, 
                    {
                        name: "None",
                        tooltip: "No impact.",
                        value: "N",
                        weight: 0.0
                    }, 
                    {
                        name: "Default",
                        tooltip: "The Default weight is the median of the weights for Critical, High, Medium, Low, and None.",
                        value: "D",
                        weight: 0.6,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Likelihood of Discovery",
                short: "DI",
                options: [
                    {
                        name: "High",
                        tooltip: "",
                        value: "H",
                        weight: 1.0
                    }, 
                    {
                        name: "Medium",
                        tooltip: "",
                        value: "M",
                        weight: 0.6
                    }, 
                    {
                        name: "Low",
                        tooltip: "",
                        value: "L",
                        weight: 0.2
                    }, 
                    {
                        name: "Default",
                        tooltip: "The median of the High, Medium, and Low values.",
                        value: "D",
                        weight: 0.6,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Likelihood of Exploit",
                short: "EX",
                options: [
                    {
                        name: "High",
                        tooltip: "It is highly likely that an attacker would target this weakness successfully, with a reliable exploit that is easy to develop.",
                        value: "H",
                        weight: 1.0
                    }, 
                    {
                        name: "Medium",
                        tooltip: "An attacker would probably target this weakness successfully, but the chances of success might vary, or require multiple attempts to succeed.",
                        value: "M",
                        weight: 0.6
                    }, 
                    {
                        name: "Low",
                        tooltip: "An attacker probably would not target this weakness, or could have very limited chances of success.",
                        value: "L",
                        weight: 0.2
                    }, 
                    {
                        name: "None",
                        tooltip: "An attacker has no chance of success; i.e., the issue is a \"bug\" because there is no attacker role, and no benefit to the attacker.",
                        value: "N",
                        weight: 0.0
                    }, 
                    {
                        name: "Default",
                        tooltip: "Median of the High, Medium, and Low values. The \"None\" value is ignored with the expectation that few weakness findings would be scored using the value, and including it in the median calculation would reduce the weight to a non-intuitive level.",
                        value: "D",
                        weight: 0.6,
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "External Control Effectiveness",
                short: "EC",
                options: [
                    {
                        name: "None",
                        tooltip: "No controls exist.",
                        value: "N",
                        weight: 1.0
                    }, 
                    {
                        name: "Limited",
                        tooltip: "",
                        value: "L",
                        weight: 0.9
                    }, 
                    {
                        name: "Moderate",
                        tooltip: "",
                        value: "M",
                        weight: 0.7
                    }, 
                    {
                        name: "Indirect (Defense-in-Depth)",
                        tooltip: "",
                        value: "I",
                        weight: 0.5
                    }, 
                    {
                        name: "Best-Available",
                        tooltip: "",
                        value: "B",
                        weight: 0.3
                    }, 
                    {
                        name: "Complete",
                        tooltip: "",
                        value: "C",
                        weight: 0.1
                    }, 
                    {
                        name: "Default",
                        tooltip: "The median of Complete, Best-Available, Indirect, Moderate, Limited, and None.",
                        value: "D",
                        weight: 0.6, 
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            },
            {
                title: "Prevalence",
                short: "P",
                options: [
                    {
                        name: "Widespread",
                        tooltip: "The weakness is found in most or all software in the associated environment, and may occur multiple times within the same software package.",
                        value: "W",
                        weight: 1.0
                    }, 
                    {
                        name: "High",
                        tooltip: "The weakness is encountered very often, but it is not widespread.",
                        value: "H",
                        weight: 0.9
                    }, 
                    {
                        name: "Common",
                        tooltip: "The weakness is encountered periodically.",
                        value: "C",
                        weight: 0.8
                    }, 
                    {
                        name: "Limited",
                        tooltip: "The weakness is encountered rarely, or never.",
                        value: "L",
                        weight: 0.7
                    }, 
                    {
                        name: "Default",
                        tooltip: "The median of Limited, Common, High, and Widespread.",
                        value: "D",
                        weight: 0.85, 
                    },
                    {
                        name: "Unknown",
                        tooltip: "There is not enough information to provide a value for this factor. Further analysis may be necessary. In the future, a different value might be chosen, which could affect the score.",
                        value: "UK",
                        weight: 0.5,
                    },
                    {
                        name: "Not Applicable",
                        tooltip: "This factor is being intentionally ignored in the score calculation because it is not relevant to how the scorer prioritizes weaknesses. This factor might not be applicable in an environment with high assurance requirements; the user might want to investigate every weakness finding of interest, regardless of confidence.",
                        value: "NA",
                        weight: 1.0
                    },
                    {
                        name: "Quantified",
                        tooltip: "This factor could be quantified with custom weights.",
                        value: "Q",
                        weight: 1.0
                    },
                ],
            }
        ],
    }
];

export default function Calculator({params}) {
    const [vec_obj, setVecObj] = useState({
        TI: { code: 'H', weight: 0.9 },
        AP: { code: 'A', weight: 1 },
        AL: { code: 'A', weight: 1 },
        IC: { code: 'N', weight: 1 },
        FC: { code: 'T', weight: 1 },
        RP: { code: 'L', weight: 0.9 },
        RL: { code: 'A', weight: 1 },
        AV: { code: 'I', weight: 1 },
        AS: { code: 'N', weight: 1 },
        IN: { code: 'T', weight: 0.9 },
        SC: { code: 'A', weight: 1 },
        BI: { code: 'C', weight: 1 },
        DI: { code: 'H', weight: 1 },
        EX: { code: 'H', weight: 1 },
        EC: { code: 'N', weight: 1 },
        P: { code: 'NA', weight: 1 }
    });
    const [cwss_obj, setCwssObj] = useState(compute_vector(vec_obj));

    const Header = (
            <Masthead style={{"position":"sticky", "top": "0px", "z-index": 1000}}>
                <MastheadMain>CWSS Calc</MastheadMain>
                <MastheadContent>
                    <ClipboardCopy
                        id="cwss-vector-str-clipboard"
                        style={{"width": "75%"}}
                        onChange={(val) => {
                            const obj = compute_vector(val);
                            setVecObj(obj.vector_obj);
                            setCwssObj(obj);
                        }}>
                            {to_vector_str(cwss_obj.vector_obj)}
                    </ClipboardCopy>
                </MastheadContent>
            </Masthead>
    );

    const FinalScore = (
        <tspan style={{fill: 'white'}}>{cwss_obj.final}</tspan>
    );

    const Score = (
        <div style={{height: '220px', width:'200px', margin: 'auto', 'text-align': 'center', 'padding-top': '20px'}}>
            <TextContent>
                <Text style={{color: 'white'}} component={TextVariants.h3}>CWSS Score</Text>
            </TextContent>
            <ChartDonutThreshold
                colorScale={["#D2D2D2", "#BBB", "#C9190B", "#A30000", "#7D1007"]}
                ariaDesc="CWSS severity levels"
                ariaTitle="CWSS Score severity thresholds"
                constrainToVisibleArea={true}
                padding={{
                    bottom: 20,
                    left: 20,
                    right: 20,
                    top: 20
                }}
                height={185}
                width={185}
                labels={({ datum }) => datum.x ? datum.x : null}
                data={[{x: "Low at 1.0", y: 1}, {x: "Medium at 40.0", y: 40}, {x: "High at 70.0", y: 70}, {x: "Critical at 90.0", y: 90}]}>
                <ChartDonutUtilization
                    style={{color: 'white'}}
                    data={{x: "CWSS Score", y: cwss_obj.final}}
                    title={FinalScore}
                    subTitle="of 100.0"
                    labels={({datum}) => `${datum.x}: ${datum.y}`}
                    thresholds={[{value: 0, color: '#D2D2D2'}, {value: 1, color: '#BBB'},{value: 40, color: '#C9190B'},{value: 70, color: '#A30000'},{value:90, color:'#7D1007'}]} />
            </ChartDonutThreshold>
        </div>
    );

    const Sidebar = (
        <PageSidebar isNavOpen={true} nav={Score} style={{"position": "sticky", "top": "70px", "max-height": "96vh"}} />
    );

    return (
        <Page header={Header} sidebar={Sidebar}>
            <CardBody>
                <Form>
                <PageSection variant={PageSectionVariants.light}>
                    {metrics.map((metric, i) => {
                        return (
                            <FormSection key={i} title={metric.title} titleElement="h2">
                                {metric.factors.map((factor, i) => {
                                    return (
                                        <FormGroup label={factor.title} isRequired fieldId={i}>
                                            <ToggleGroup>
                                            {factor.options.map((option, i) => {
                                                const buttonId = `button-${factor.short}-${option.value}-${option.weight}`;
                                                return (
                                                    <ToggleGroupItem
                                                        key={i}
                                                        text={option.name}
                                                        buttonId={buttonId}
                                                        isSelected={vec_obj[factor.short].code==option.value}
                                                        onChange={(isChanged, event) => {
                                                            if(isChanged) {
                                                                const target = event.currentTarget.id.split("-");
                                                                const obj = Object.assign({}, vec_obj);
                                                                obj[target[1]] = {code: target[2], weight: Number.parseFloat(target[3])};
                                                                setVecObj(obj);
                                                                setCwssObj(compute_vector(obj));
                                                            }
                                                        }}/>
                                                );
                                            })}
                                            <NumberInput
                                                value={vec_obj[factor.short].weight.toFixed(2)}
                                                isDisabled={vec_obj[factor.short].code!=="Q"}
                                                style={{'--pf-c-form-control--Width': '50pt'}}
                                                onChange={(value) => {
                                                    const obj = Object.assign({}, vec_obj);
                                                    obj[factor.short].weight = Number.parseFloat(value);
                                                    setVecObj(obj);
                                                    setCwssObj(compute_vector(obj));
                                                }}
                                                min={0}
                                                max={1.0}
                                                onPlus={(event) => {
                                                    const obj = Object.assign({}, vec_obj);
                                                    if(obj[factor.short].weight + 0.05 <= 1.0) {
                                                        obj[factor.short].weight += 0.05;
                                                        setVecObj(obj);
                                                    }
                                                }}
                                                onMinus={(event) => {
                                                    const obj = Object.assign({}, vec_obj);
                                                    if(obj[factor.short].weight - 0.05 >= 0) {
                                                        obj[factor.short].weight -= 0.05;
                                                        setVecObj(obj);
                                                    }
                                                }}/>
                                            </ToggleGroup>
                                        </FormGroup>
                                    );
                                })}
                            </FormSection>
                        );
                    })}
                </PageSection>
                </Form>
            </CardBody>
        </Page>
    );
}
